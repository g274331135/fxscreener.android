<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="fxscreener.android.Views.InstrumentsPage"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <Grid Grid.Row="0" 
              BackgroundColor="{DynamicResource Primary}"
              HeightRequest="50">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <ImageButton Grid.Column="0"
                         BackgroundColor="Transparent"
                         WidthRequest="40"
                         HeightRequest="40"
                         HorizontalOptions="Start"
                         Clicked="OnBackButtonClicked">
                <ImageButton.Source>
                    <FontImageSource FontFamily="MaterialIcons"
                                     Glyph="&#xe5c4;"
                                     Color="White"
                                     Size="24"/>
                </ImageButton.Source>
            </ImageButton>

            <Label Grid.Column="1"
                   Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸"
                   TextColor="White"
                   FontSize="18"
                   FontAttributes="Bold"
                   VerticalOptions="Center"
                   HorizontalOptions="Start"/>
        </Grid>

        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Instruments}"
                        SelectionMode="None"
                        Margin="10">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItem Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ" 
                                        BackgroundColor="Red"
                                        Command="{Binding DeleteInstrumentCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                        CommandParameter="{Binding .}"/>
                        </SwipeView.RightItems>

                        <Grid Padding="10,5"
                              ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <VerticalStackLayout Grid.Column="0" Spacing="2">
                                <Label Text="{Binding Symbol}" 
                                       FontSize="16" 
                                       FontAttributes="Bold"/>
                                <Label Text="{Binding Period}" 
                                       FontSize="12" 
                                       TextColor="Gray"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="2">
                                <Label Text="{Binding Description}" 
                                       FontSize="12"
                                       LineBreakMode="TailTruncation"/>
                                <Label Text="{Binding LastUpdated, StringFormat='ÐžÐ±Ð½: {0:HH:mm dd.MM'}"
                                       FontSize="10"
                                       TextColor="Gray"/>
                            </VerticalStackLayout>

                            <!-- Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Switch -->
                            <Switch Grid.Column="2"
                                    IsToggled="{Binding IsActive}"
                                    Toggled="OnSwitchToggled"/>
                        </Grid>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
        <HorizontalStackLayout Grid.Row="2"
                               Spacing="10"
                               Padding="10"
                               HorizontalOptions="Center">

            <Button Text="âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ"
                    Command="{Binding AddInstrumentCommand}"
                    BackgroundColor="{DynamicResource Primary}"
                    TextColor="White"
                    IsEnabled="{Binding IsNotLoading}"/>

            <Button Text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¸Ð· API"
                    Command="{Binding RefreshFromApiCommand}"
                    BackgroundColor="Gray"
                    TextColor="White"
                    IsEnabled="{Binding IsNotLoading}"/>
        </HorizontalStackLayout>

        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <AbsoluteLayout Grid.Row="1"
                        Grid.RowSpan="2"
                        IsVisible="{Binding IsLoading}"
                        BackgroundColor="#80000000"
                        HorizontalOptions="Fill"
                        VerticalOptions="Fill">
            <ActivityIndicator IsRunning="True"
                               AbsoluteLayout.LayoutBounds="0.5, 0.5, 50, 50"
                               AbsoluteLayout.LayoutFlags="PositionProportional"
                               Color="{DynamicResource Primary}"/>
        </AbsoluteLayout>

        <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
        <Border Grid.Row="3"
                StrokeThickness="1"
                Stroke="{Binding StatusColor}"
                Padding="8"
                Margin="5">
            <Label Text="{Binding StatusMessage}"
                   TextColor="{Binding StatusColor}"
                   FontSize="11"
                   HorizontalOptions="Center"/>
        </Border>
    </Grid>
</ContentPage>